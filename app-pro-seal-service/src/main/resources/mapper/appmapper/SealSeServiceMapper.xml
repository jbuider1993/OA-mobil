<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.app.dao.SealSeServiceDao">
	
	<select id="querySealSeServiceList" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
        	a.id,
			a.order_num orderNum,
			b.`name` serviceTypeName,
			a.state,
			CASE a.state WHEN '1' THEN '待派工' WHEN '2' THEN '待接单' WHEN '3' THEN '待签到' WHEN '4' THEN '待完工' WHEN '5' THEN '待评价' WHEN '6' THEN '待审核' WHEN '7' THEN '已完工' END stateName,
			CONVERT(a.declaration_time, CHAR) declarationTime,
			a.contacts,
			a.phone,
			a.customer_name customerName,
			c.user_name receiver,
			a.type,
			CASE a.type WHEN '1' THEN '微信报单' ELSE '用户报单' END typeName,
			d.user_name declarationName
		FROM
			crm_service a
			LEFT JOIN sys_eve_user_staff d ON a.declaration_id = d.user_id
			LEFT JOIN sys_eve_user_staff c ON a.service_user_id = c.user_id,
			crm_service_type b
		WHERE
			a.type_id = b.id 
        ORDER BY a.declaration_time desc
    </select>
	
	<select id="querySealServiceWaitToWorkOrder" resultType="java.util.Map">
        SELECT
        	a.id,
			a.order_num orderNum,
			b.`name` serviceTypeName,
			a.customer_name customerName,
			a.product_name productName,
			CONVERT(a.declaration_time, CHAR) declarationTime
		FROM
			crm_service a,
		 	crm_service_type b
		WHERE
			a.state = 1
		AND	a.type_id = b.id
        ORDER BY a.declaration_time desc
    </select>
    
    <select id="querySealSeServiceWaitToReceiveList" resultType="java.util.Map">
        SELECT
        	a.id,
			a.order_num orderNum,
			b.`name` serviceTypeName,
			a.customer_name customerName,
			a.product_name productName,
			CONVERT(a.declaration_time, CHAR) declarationTime
		FROM
			crm_service a,
		 	crm_service_type b
		WHERE
			a.service_user_id = #{receiver}
		AND	a.state = 2
		AND	a.type_id = b.id
        ORDER BY a.declaration_time desc
    </select>
    
    <select id="querySealSeServiceWaitToSignonList" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
        	a.id,
			a.order_num orderNum,
			b.`name` serviceTypeName,
			a.customer_name customerName,
			a.product_name productName,
			CONVERT(a.declaration_time, CHAR) declarationTime
		FROM
			crm_service a,
		 	crm_service_type b
		WHERE
			a.service_user_id = #{receiver}
		AND	a.state = 3
		AND	a.type_id = b.id
        ORDER BY a.declaration_time desc
    </select>
    
    <select id="querySealSeServiceWaitToFinishList" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
        	a.id,
			a.order_num orderNum,
			b.`name` serviceTypeName,
			a.customer_name customerName,
			a.product_name productName,
			CONVERT(a.declaration_time, CHAR) declarationTime
		FROM
			crm_service a,
		 	crm_service_type b
		WHERE
			a.service_user_id = #{receiver}
		AND	a.state = 4
		AND	a.type_id = b.id
        ORDER BY a.declaration_time desc
    </select>
    
</mapper>